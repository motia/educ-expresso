# /usr/bin/node
const knex = require('../db')

function makeid(length) {
   const result           = '';
   const characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
   const charactersLength = characters.length;
   for ( const i = 0; i < length; i++ ) {
      result += characters.charAt(Math.floor(Math.random() * charactersLength));
   }
   return result;
}

const username = process.argv[0];

if (username) {
    throw new Error('Require username parameter');
}
const password = makeid(12);
const hash = bcrypt.hashSync(username, process.env.SALT_ROUNDS || 10);

knex('users')
  .insert({ username, password: hash })
  .then(() => {
    console.log(`User ${username} created with random password`);
    console.log(password);
  })
